function join(e,t,r){var a="";if(r||(r=9999),t.length>0){t=t.reverse(),a=t.pop();for(var n=0;t.length>0&&n++<r;)a+=e+t.pop()}return a}function array_search(e,t){for(var r=0;r<e.length;r++)for(var a=0;a<t.length;a++)if(t[a]===e[r])return a;return!1}var module={exports:null};!function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(r,a){function n(){!e&&this.init&&this.init.apply(this,arguments)}void 0==a&&(a=r,r="Class");var s=this.prototype;e=!0;var i=new this;e=!1;for(var c in a)i[c]="function"==typeof a[c]&&"function"==typeof s[c]&&t.test(a[c])?function(e,t){return function(){var r=this._super;this._super=s[e];var a=t.apply(this,arguments);return this._super=r,a}}(c,a[c]):a[c];n.prototype=i;var l=new Function("return function "+r+"(){ }")();return n.prototype.constructor=l,n.extend=arguments.callee,n},module.exports=Class}();var Searchbar=Class.extend({searchbar:null,searchable:null,hiddenClass:"searchable-row-hidden",init:function(){if(this.searchbar=document.querySelector(".searchbar"),this.searchable=document.querySelector(".searchable"),this.searchbar&&this.searchable&&this.parseSearchable())for(var e=this.getSearchbarElements(),t=0;t<e.length;++t)this.processSearchbarElement(e[t])},parseSearchable:function(){var e=this.getSearchableRows();if(0===e.length)return!1;for(var t=0;t<e.length;++t)for(var r=e[t].querySelectorAll("[data-searchbar-value]"),a=0;a<r.length;++a)this.processCell(r[a],e[t]);return!0},getSearchableRows:function(){var e=this.searchable.querySelectorAll(".searchable-row");return 0===e.length&&"TABLE"===this.searchable.tagName&&(e=this.searchable.querySelectorAll("tbody tr")),e},processCell:function(e,t){var r="data-"+e.getAttribute("headers"),a=e.getAttribute("data-searchbar-value");t.setAttribute(r,a),"1"===e.getAttribute("data-searchbar-value-list")&&t.setAttribute(r+"-list",1)},getSearchbarElements:function(){return this.searchbar.querySelectorAll("input, select, button")},processSearchbarElement:function(e){var t="",r=0;switch(e.type){case"text":t="keyup",r=150;break;case"select-one":t="change";break;case"checkbox":case"reset":t="click"}if(t.length>0){var a="reset"!==e.type?this.debounce(this.search,r).bind(this):this.reset.bind(this);e.addEventListener(t,a)}},search:function(){var e=new Event("searchbar:beforeSearch");if(this.searchbar.dispatchEvent(e)){this.resetSearchable();for(var t=this.getSearchableRows(),r=0;r<t.length;++r){for(var a=t[r],n=!0,s=this.getSearchbarElements(),i=0;i<s.length;i++)if(n){var c=s[i],l=this.getValue(c),o=this.getAttr(c);if(o&&l&&"all"!==l){var u="text"!==c.type?this.nonTextSearch(a,o,l):this.textSearch(a,o,l);n=n&&u}}n||a.classList.add(this.hiddenClass)}this.searchbar.dispatchEvent(new Event("searchbar:afterSearch"))}},getValue:function(e){switch(e.type){case"text":return e.value;case"select-one":return e.options[e.selectedIndex].value;case"checkbox":return e.checked}return""},getAttr:function(e){var t=e.getAttribute("id");return t?"data-"+(t=t.replace(/_.*/,"")):""},nonTextSearch:function(e,t,r){return e.hasAttribute(t+"-list")?e.matches("["+t+"*=_"+r+"_]"):e.getAttribute(t)===r},textSearch:function(e,t,r){try{var a=new RegExp(r,"i");return e.getAttribute(t).match(a)}catch(e){return!1}},reset:function(){var e=new Event("searchbar:reset");return!this.searchbar.dispatchEvent(e)||(this.searchbar.reset(),this.resetSearchable()),!1},resetSearchable:function(){for(var e=this.getSearchableRows(),t=0;t<e.length;++t)e[t].classList.remove(this.hiddenClass)},debounce:function(e,t,r){if(0===t)return e;var a;return function(){var n=this,s=arguments,i=function(){a=null,r||e.apply(n,s)},c=r&&!a;clearTimeout(a),a=setTimeout(i,t),c&&e.apply(n,s)}}}),Focuser=Class.extend({init:function(){var e=document.querySelector("[autofocus]");if(e&&e.length>0)return void e[0].focus();var t=document.getElementById("shadowlab-form");if(t){var r=t.querySelector("input, select, textarea");r&&r.length>0&&r[0].focus()}}}),Summarizer=Class.extend({element:null,init:function(e){if(e||(e=this.getElement()),e.tagName&&"TABLE"===e.tagName&&e.matches(".summarized"))for(var t=e.querySelectorAll(".summary *:first-child a"),r=0;r<t.length;r++)t[r].addEventListener("click",this.summaryClicked.bind(this))},getElement:function(){return document.querySelector("table.summarized")},summaryClicked:function(e){var t=this.getClosest(e.target,"tbody");this.toggleClass(t,"clicked"),e.stopPropagation(),e.preventDefault()},getClosest:function(e,t){do{if(e.matches(t))return e}while(e=e.parentNode);return null},toggleClass:function(e,t){e.classList.toggle(t,!e.classList.contains(t))}}),Shadowlab=new Vue({data:vueData,el:"#shadowlab",mounted:function(){document.title=this.title+" | Shadowlab"},filters:{capitalize:function(e){return(e+"").replace(/^([a-z\u00E0-\u00FC])|\s+([a-z\u00E0-\u00FC])/g,function(e){return e.toUpperCase()})},nl2br:function(e){return void 0===e||null===e?"":(e+"").replace(/(\r\n|\n\r|\r|\n)/g,"<br>$1")},makeUpdateLink:function(e){var t=window.location.href.split("/");return join("/",t,array_search(["create","read","update","delete"],t)-1)+"/update/"+e},makeCollectionLink:function(e){var t=window.location.href.split("/");return e=array_search([e],t),join("/",t,e)}}});document.addEventListener("DOMContentLoaded",function(){document.getElementsByClassName("searchbar").length>0&&new Searchbar,document.getElementsByClassName("summarized").length>0&&new Summarizer,new Focuser});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNoYWRvd2xhYi5qcyIsIm1vZHVsZS1zdHViLmpzIiwiY2xhc3MuanMiLCJzZWFyY2hiYXIuanMiLCJmb2N1c2VyLmpzIiwic3VtbWFyaXplci5qcyJdLCJuYW1lcyI6WyJqb2luIiwiZ2x1ZSIsInBpZWNlcyIsImxpbWl0Iiwiam9pbmVkIiwibGVuZ3RoIiwicmV2ZXJzZSIsInBvcCIsImNvdW50IiwiYXJyYXlfc2VhcmNoIiwibmVlZGxlcyIsImhheXN0YWNrIiwiaSIsImoiLCJtb2R1bGUiLCJleHBvcnRzIiwiaW5pdGlhbGl6aW5nIiwiZm5UZXN0IiwidGVzdCIsInh5eiIsInRoaXMiLCJDbGFzcyIsImV4dGVuZCIsImNsYXNzTmFtZSIsInByb3AiLCJpbml0IiwiYXBwbHkiLCJhcmd1bWVudHMiLCJ1bmRlZmluZWQiLCJfc3VwZXIiLCJwcm90b3R5cGUiLCJuYW1lIiwiZm4iLCJ0bXAiLCJyZXQiLCJmdW5jIiwiRnVuY3Rpb24iLCJjb25zdHJ1Y3RvciIsImNhbGxlZSIsIlNlYXJjaGJhciIsInNlYXJjaGJhciIsInNlYXJjaGFibGUiLCJoaWRkZW5DbGFzcyIsImRvY3VtZW50IiwicXVlcnlTZWxlY3RvciIsInBhcnNlU2VhcmNoYWJsZSIsImVsZW1lbnRzIiwiZ2V0U2VhcmNoYmFyRWxlbWVudHMiLCJwcm9jZXNzU2VhcmNoYmFyRWxlbWVudCIsInJvd3MiLCJnZXRTZWFyY2hhYmxlUm93cyIsImNlbGxzIiwicXVlcnlTZWxlY3RvckFsbCIsInByb2Nlc3NDZWxsIiwidGFnTmFtZSIsImNlbGwiLCJyb3ciLCJhdHRyIiwiZ2V0QXR0cmlidXRlIiwidmFsdWUiLCJzZXRBdHRyaWJ1dGUiLCJlbGVtZW50IiwiZXZlbnQiLCJ3YWl0IiwidHlwZSIsImRlYm91bmNlIiwic2VhcmNoIiwiYmluZCIsInJlc2V0IiwiYWRkRXZlbnRMaXN0ZW5lciIsImJlZm9yZVNlYXJjaCIsIkV2ZW50IiwiZGlzcGF0Y2hFdmVudCIsInJlc2V0U2VhcmNoYWJsZSIsInNob3ciLCJnZXRWYWx1ZSIsImdldEF0dHIiLCJjcml0ZXJpb24iLCJub25UZXh0U2VhcmNoIiwidGV4dFNlYXJjaCIsImNsYXNzTGlzdCIsImFkZCIsIm9wdGlvbnMiLCJzZWxlY3RlZEluZGV4IiwiY2hlY2tlZCIsImlkIiwicmVwbGFjZSIsImhhc0F0dHJpYnV0ZSIsIm1hdGNoZXMiLCJwYXR0ZXJuIiwiUmVnRXhwIiwibWF0Y2giLCJlIiwiYmVmb3JlUmVzZXQiLCJyZW1vdmUiLCJpbW1lZGlhdGUiLCJ0aW1lb3V0IiwiY29udGV4dCIsImFyZ3MiLCJsYXRlciIsImNhbGxOb3ciLCJjbGVhclRpbWVvdXQiLCJzZXRUaW1lb3V0IiwiRm9jdXNlciIsImZvY3VzIiwiZm9ybSIsImdldEVsZW1lbnRCeUlkIiwiaW5wdXRzIiwiU3VtbWFyaXplciIsImdldEVsZW1lbnQiLCJjbGlja2VycyIsInN1bW1hcnlDbGlja2VkIiwidGJvZHkiLCJnZXRDbG9zZXN0IiwidGFyZ2V0IiwidG9nZ2xlQ2xhc3MiLCJzdG9wUHJvcGFnYXRpb24iLCJwcmV2ZW50RGVmYXVsdCIsInBhcmVudE5vZGUiLCJ0b2dnbGUiLCJjb250YWlucyIsIlNoYWRvd2xhYiIsIlZ1ZSIsImRhdGEiLCJ2dWVEYXRhIiwiZWwiLCJtb3VudGVkIiwidGl0bGUiLCJmaWx0ZXJzIiwiY2FwaXRhbGl6ZSIsInN0ciIsIiQxIiwidG9VcHBlckNhc2UiLCJubDJiciIsIm1ha2VVcGRhdGVMaW5rIiwiaHJlZlBhcnRzIiwid2luZG93IiwibG9jYXRpb24iLCJocmVmIiwic3BsaXQiLCJtYWtlQ29sbGVjdGlvbkxpbmsiLCJlbmRwb2ludCIsImdldEVsZW1lbnRzQnlDbGFzc05hbWUiXSwibWFwcGluZ3MiOiJBQWlGQSxRQUFBQSxNQUFBQyxFQUFBQyxFQUFBQyxHQUNBLEdBQUFDLEdBQUEsRUFhQSxJQVhBRCxJQUNBQSxFQUFBLE1BVUFELEVBQUFHLE9BQUEsRUFBQSxDQUNBSCxFQUFBQSxFQUFBSSxVQUNBRixFQUFBRixFQUFBSyxLQUdBLEtBREEs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QixVQUFBd0MsU0FBQWpHLE9MbkVBa0csVUFBQSxHQUFBQyxNQUNBQyxLQUFBQyxRQUNBQyxHQUFBLGFBTUFDLFFBQUEsV0FDQW5GLFNBQUFvRixNQUFBM0csS0FBQTJHLE1BQUEsZ0JBR0FDLFNBQ0FDLFdBQUEsU0FBQUMsR0FJQSxPQUFBQSxFQUFBLElBQUE1QyxRQUFBLGlEQUFBLFNBQUE2QyxHQUNBLE1BQUFBLEdBQUFDLGlCQUlBQyxNQUFBLFNBQUFILEdBSUEsV0FBQSxLQUFBQSxHQUFBLE9BQUFBLEVBQ0EsSUFNQUEsRUFBQSxJQUFBNUMsUUFBQSxxQkFBQSxXQUdBZ0QsZUFBQSxTQUFBakQsR0FDQSxHQUFBa0QsR0FBQUMsT0FBQUMsU0FBQUMsS0FBQUMsTUFBQSxJQVNBLE9BQUEzSSxNQUFBLElBQUF1SSxFQURBOUgsY0FBQSxTQUFBLE9BQUEsU0FBQSxVQUFBOEgsR0FDQSxHQUFBLFdBQUFsRCxHQUdBdUQsbUJBQUEsU0FBQUMsR0FDQSxHQUFBTixHQUFBQyxPQUFBQyxTQUFBQyxLQUFBQyxNQUFBLElBUUEsT0FEQUUsR0FBQXBJLGNBQUFvSSxHQUFBTixHQUNBdkksS0FBQSxJQUFBdUksRUFBQU0sTUFLQWxHLFVBQUEwQixpQkFBQSxtQkFBQSxXQUNBMUIsU0FBQW1HLHVCQUFBLGFBQUF6SSxPQUFBLEdBQ0EsR0FBQWtDLFdBR0FJLFNBQUFtRyx1QkFBQSxjQUFBekksT0FBQSxHQUNBLEdBQUF1RyxZQUdBLEdBQUFMIiwiZmlsZSI6InNoYWRvd2xhYi5jb21wbGV0ZS5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBTaGFkb3dsYWIgPSBuZXcgVnVlKHtcclxuXHRkYXRhOiB2dWVEYXRhLFxyXG5cdGVsOiBcIiNzaGFkb3dsYWJcIixcclxuXHJcblx0Ly8gc2luY2UgdGhlIDx0aXRsZT4gdGFnIGlzIG91dHNpZGUgb2YgdGhlIGRpdiNzaGFkb3dsYWIgZWxlbWVudCxcclxuXHQvLyB3ZSBoYXZlIHRvIGFsdGVyIGl0IGFmdGVyIHRoZSBWdWUgb2JqZWN0IGlzIG1vdW50ZWQgYnkgaGFuZCBhc1xyXG5cdC8vIGZvbGxvd3MuXHJcblxyXG5cdG1vdW50ZWQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0ZG9jdW1lbnQudGl0bGUgPSB0aGlzLnRpdGxlICsgXCIgfCBTaGFkb3dsYWJcIjtcclxuXHR9LFxyXG5cclxuXHRmaWx0ZXJzOiB7XHJcblx0XHRjYXBpdGFsaXplOiBmdW5jdGlvbihzdHIpIHtcclxuXHJcblx0XHRcdC8vIHNvdXJjZTogaHR0cDovL2xvY3V0dXMuaW8vcGhwL3N0cmluZ3MvdWN3b3Jkcy9cclxuXHJcblx0XHRcdHJldHVybiAoc3RyICsgJycpLnJlcGxhY2UoL14oW2EtelxcdTAwRTAtXFx1MDBGQ10pfFxccysoW2EtelxcdTAwRTAtXFx1MDBGQ10pL2csIGZ1bmN0aW9uKCQxKSB7XHJcblx0XHRcdFx0cmV0dXJuICQxLnRvVXBwZXJDYXNlKClcclxuXHRcdFx0fSlcclxuXHRcdH0sXHJcblxyXG5cdFx0bmwyYnI6IGZ1bmN0aW9uKHN0cikge1xyXG5cclxuXHRcdFx0Ly8gc291cmNlOiBodHRwOi8vbG9jdXR1cy5pby9waHAvc3RyaW5ncy9ubDJici9cclxuXHJcblx0XHRcdGlmICh0eXBlb2Ygc3RyID09PSAndW5kZWZpbmVkJyB8fCBzdHIgPT09IG51bGwpIHtcclxuXHRcdFx0XHRyZXR1cm4gJydcclxuXHRcdFx0fVxyXG5cclxuXHRcdFx0Ly8gYWx0ZXJlZCBzb3VyY2U6IHJlbW92ZWQgc3dpdGNoIGJldHdlZW4gWEhUTUwgYW5kIEhUTUxcclxuXHRcdFx0Ly8gdmVyc2lvbiBvZiB0aGUgYnJlYWsgdGFnLlxyXG5cclxuXHRcdFx0cmV0dXJuIChzdHIgKyAnJykucmVwbGFjZSgvKFxcclxcbnxcXG5cXHJ8XFxyfFxcbikvZywgJzxicj4nICsgJyQxJylcclxuXHRcdH0sXHJcblxyXG5cdFx0bWFrZVVwZGF0ZUxpbms6IGZ1bmN0aW9uKGlkKSB7XHJcblx0XHRcdHZhciBocmVmUGFydHMgPSB3aW5kb3cubG9jYXRpb24uaHJlZi5zcGxpdChcIi9cIik7XHJcblxyXG5cdFx0XHQvLyB3ZSBjb3VsZCBiZSBjcmVhdGluZyBhbiB1cGRhdGUgbGluayBmcm9tIGFsbW9zdCBhbnkgb2Ygb3VyXHJcblx0XHRcdC8vIHBhZ2VzLCBzbyB3ZSB3YW50IHRvIHNlYXJjaCB0aHJvdWdoIHRoZSBwYXJ0cyBvZiBvdXIgY3VycmVudFxyXG5cdFx0XHQvLyBocmVmIGZvciBhbnkgb2Ygb3VyIGFwcGxpY2F0aW9uIGFjdGlvbnMuICB3aGVuIHdlIGlkZW50aWZ5XHJcblx0XHRcdC8vIG9uZSBvZiB0aGVtLCB3ZSBrbm93IHdoZXJlIHRvIHN0b3Agb3VyIHJlLWpvaW5pbmcgYWN0aW9uIGZvclxyXG5cdFx0XHQvLyBvdXIgbmV3IGhyZWYuXHJcblxyXG5cdFx0XHR2YXIgZW5kcG9pbnQgPSBhcnJheV9zZWFyY2goW1wiY3JlYXRlXCIsIFwicmVhZFwiLCBcInVwZGF0ZVwiLCBcImRlbGV0ZVwiXSwgaHJlZlBhcnRzKTtcclxuXHRcdFx0cmV0dXJuIGpvaW4oXCIvXCIsIGhyZWZQYXJ0cywgZW5kcG9pbnQtMSkgKyAnL3VwZGF0ZS8nICsgaWQ7XHJcblx0XHR9LFxyXG5cclxuXHRcdG1ha2VDb2xsZWN0aW9uTGluazogZnVuY3Rpb24oZW5kcG9pbnQpIHtcclxuXHRcdFx0dmFyIGhyZWZQYXJ0cyA9IHdpbmRvdy5sb2NhdGlvbi5ocmVmLnNwbGl0KFwiL1wiKTtcclxuXHJcblx0XHRcdC8vIGhlcmUsIHdlIHdhbnQgdG8gc3RvcCB0aGUgcmUtYnVpbGRpbmcgb2Ygb3VyIGhyZWYgYXQgdGhlXHJcblx0XHRcdC8vIHNwZWNpZmllZCBlbmRwb2ludC4gIHJlbWVtYmVyOiBhcnJheV9zZWFyY2goKSBiZWxvdyB1c2VzIGFuXHJcblx0XHRcdC8vIEFycmF5IGFzIHRoZSBmaXJzdCBhcmd1bWVudCwgc28gd2UgY3JhbSBvdXIgZW5kcG9pbnRcclxuXHRcdFx0Ly8gcGFyYW1ldGVyIGludG8gb25lIGFzIHdlIHNlbmQgaXQgdGhlcmUuXHJcblxyXG5cdFx0XHRlbmRwb2ludCA9IGFycmF5X3NlYXJjaChbZW5kcG9pbnRdLCBocmVmUGFydHMpO1xyXG5cdFx0XHRyZXR1cm4gam9pbihcIi9cIiwgaHJlZlBhcnRzLCBlbmRwb2ludCk7XHJcblx0XHR9XHJcblx0fVxyXG59KTtcclxuXHJcbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJET01Db250ZW50TG9hZGVkXCIsIGZ1bmN0aW9uKCkge1xyXG5cdGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwic2VhcmNoYmFyXCIpLmxlbmd0aCA+IDApIHtcclxuXHRcdG5ldyBTZWFyY2hiYXIoKTtcclxuXHR9XHJcblxyXG5cdGlmIChkb2N1bWVudC5nZXRFbGVtZW50c0J5Q2xhc3NOYW1lKFwic3VtbWFyaXplZFwiKS5sZW5ndGggPiAwKSB7XHJcblx0XHRuZXcgU3VtbWFyaXplcigpO1xyXG5cdH1cclxuXHJcblx0bmV3IEZvY3VzZXIoKTtcclxufSk7XHJcblxyXG4vKlxyXG4gKiBBZGRpdGlvbmFsL0hlbHBlciBmdW5jdGlvbnNcclxuICogVGhlc2UgZnVuY3Rpb25zIGFyZSB1c2VkIGFib3ZlIHRvIGFzc2lzdCBpbiBmaWx0ZXJzLCBmb3IgZXhhbXBsZS5cclxuICogVXN1YWxseSwgdGhleSdyZSBtb2NrLXVwcyBvZiBQSFAtbGlrZSBmdW5jdGlvbnMgZm9yIG91ciBjb252ZW5pZW5jZS5cclxuICovXHJcblxyXG5mdW5jdGlvbiBqb2luKGdsdWUsIHBpZWNlcywgbGltaXQpIHtcclxuXHR2YXIgam9pbmVkID0gJyc7XHJcblxyXG5cdGlmICghbGltaXQpIHtcclxuXHRcdGxpbWl0ID0gOTk5OTtcclxuXHR9XHJcblxyXG5cdC8vIGFzIGxvbmcgYXMgd2UgaGF2ZSBtb3JlIHRoYW4gb25lIHBpZWNlLCB3ZSdsbCByZXZlcnNlIG91clxyXG5cdC8vIGFycmF5IGFuZCBwb3AgaXRlbXMgb2ZmIG9mIGl0IHRvIGNyZWF0ZSBvdXIgam9pbmVkIHN0cmluZy5cclxuXHQvLyBzbywgaWYgb3VyIGFycmF5IGlzIFtBLCBCLCBDXSwgdGhlIHJldmVyc2FsIGlzLCBvYnZpb3VzbHksXHJcblx0Ly8gW0MsIEIsIEFdLiAgdGhlbiwgd2Ugc3RhcnQgb3VyIHN0cmluZyBieSBwb3BwaW5nIHRoZSBBIG9mZi5cclxuXHQvLyB0aGVuLCB3ZSBwb3AgdGhlIEIgYW5kIHRoZSBDIG9mZiBhbmQgcHJlZml4aW5nIHRoZW0gd2l0aFxyXG5cdC8vIHRoZSBnbHVlLlxyXG5cclxuXHRpZiAocGllY2VzLmxlbmd0aCA+IDApIHtcclxuXHRcdHBpZWNlcyA9IHBpZWNlcy5yZXZlcnNlKCk7XHJcblx0XHRqb2luZWQgPSBwaWVjZXMucG9wKCk7XHJcblxyXG5cdFx0dmFyIGNvdW50ID0gMDtcclxuXHRcdHdoaWxlKHBpZWNlcy5sZW5ndGggPiAwICYmIGNvdW50KysgPCBsaW1pdCkge1xyXG5cdFx0XHRqb2luZWQgKz0gZ2x1ZSArIHBpZWNlcy5wb3AoKTtcclxuXHRcdH1cclxuXHR9XHJcblxyXG5cdHJldHVybiBqb2luZWQ7XHJcbn1cclxuXHJcbmZ1bmN0aW9uIGFycmF5X3NlYXJjaCAobmVlZGxlcywgaGF5c3RhY2spIHtcclxuXHJcblx0Ly8gbGlrZSB0aGUgUEhQIGZ1bmN0aW9uIG9mIHRoZSBzYW1lIG5hbWUsIHdlIHdhbnQgdG8gcmV0dXJuIHRoZVxyXG5cdC8vIGluZGV4IG9mIG91ciBmaXJzdCBuZWVkbGUgd2l0aGluIHRoZSBoYXlzdGFjay4gIHNvIHdlIGxvb3Agb3ZlclxyXG5cdC8vIHRoZSBuZWVkbGVzIGFuZCBjb21wYXJlIHRoZW0gYWdhaW5zdCB0aGUgaGF5c3RhY2sgYXJyYXkuXHJcblxyXG5cdGZvciAodmFyIGk9MDsgaSA8IG5lZWRsZXMubGVuZ3RoOyBpKyspIHtcclxuXHRcdGZvciAodmFyIGo9MDsgaiA8IGhheXN0YWNrLmxlbmd0aDsgaisrKSB7XHJcblx0XHRcdGlmIChoYXlzdGFja1tqXSA9PT0gbmVlZGxlc1tpXSkge1xyXG5cdFx0XHRcdHJldHVybiBqO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblx0fVxyXG5cclxuXHRyZXR1cm4gZmFsc2VcclxufVxyXG4iLCJ2YXIgbW9kdWxlID0geyBleHBvcnRzOiBudWxsIH07XHJcbiIsIihmdW5jdGlvbigpe1xuICB2YXIgaW5pdGlhbGl6aW5nID0gZmFsc2UsIGZuVGVzdCA9IC94eXovLnRlc3QoZnVuY3Rpb24oKXt4eXo7fSkgPyAvXFxiX3N1cGVyXFxiLyA6IC8uKi87XG5cbiAgLy8gVGhlIGJhc2UgQ2xhc3MgaW1wbGVtZW50YXRpb24gKGRvZXMgbm90aGluZylcbiAgdGhpcy5DbGFzcyA9IGZ1bmN0aW9uKCl7fTtcblxuICAvLyBDcmVhdGUgYSBuZXcgQ2xhc3MgdGhhdCBpbmhlcml0cyBmcm9tIHRoaXMgY2xhc3NcbiAgQ2xhc3MuZXh0ZW5kID0gZnVuY3Rpb24oY2xhc3NOYW1lLCBwcm9wKSB7XG4gICAgaWYocHJvcCA9PSB1bmRlZmluZWQpIHtcbiAgICAgICAgcHJvcCA9IGNsYXNzTmFtZTtcbiAgICAgICBjbGFzc05hbWUgPSBcIkNsYXNzXCI7XG4gICAgfVxuXG4gICAgdmFyIF9zdXBlciA9IHRoaXMucHJvdG90eXBlO1xuXG4gICAgLy8gSW5zdGFudGlhdGUgYSBiYXNlIGNsYXNzIChidXQgb25seSBjcmVhdGUgdGhlIGluc3RhbmNlLFxuICAgIC8vIGRvbid0IHJ1biB0aGUgaW5pdCBjb25zdHJ1Y3RvcilcbiAgICBpbml0aWFsaXppbmcgPSB0cnVlO1xuICAgIHZhciBwcm90b3R5cGUgPSBuZXcgdGhpcygpO1xuICAgIGluaXRpYWxpemluZyA9IGZhbHNlO1xuXG4gICAgLy8gQ29weSB0aGUgcHJvcGVydGllcyBvdmVyIG9udG8gdGhlIG5ldyBwcm90b3R5cGVcbiAgICBmb3IgKHZhciBuYW1lIGluIHByb3ApIHtcbiAgICAgIC8vIENoZWNrIGlmIHdlJ3JlIG92ZXJ3cml0aW5nIGFuIGV4aXN0aW5nIGZ1bmN0aW9uXG4gICAgICBwcm90b3R5cGVbbmFtZV0gPSB0eXBlb2YgcHJvcFtuYW1lXSA9PSBcImZ1bmN0aW9uXCIgJiZcbiAgICAgICAgdHlwZW9mIF9zdXBlcltuYW1lXSA9PSBcImZ1bmN0aW9uXCIgJiYgZm5UZXN0LnRlc3QocHJvcFtuYW1lXSkgP1xuICAgICAgICAoZnVuY3Rpb24obmFtZSwgZm4pe1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIHZhciB0bXAgPSB0aGlzLl9zdXBlcjtcblxuICAgICAgICAgICAgLy8gQWRkIGEgbmV3IC5fc3VwZXIoKSBtZXRob2QgdGhhdCBpcyB0aGUgc2FtZSBtZXRob2RcbiAgICAgICAgICAgIC8vIGJ1dCBvbiB0aGUgc3VwZXItY2xhc3NcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyID0gX3N1cGVyW25hbWVdO1xuXG4gICAgICAgICAgICAvLyBUaGUgbWV0aG9kIG9ubHkgbmVlZCB0byBiZSBib3VuZCB0ZW1wb3JhcmlseSwgc28gd2VcbiAgICAgICAgICAgIC8vIHJlbW92ZSBpdCB3aGVuIHdlJ3JlIGRvbmUgZXhlY3V0aW5nXG4gICAgICAgICAgICB2YXIgcmV0ID0gZm4uYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICAgICAgICAgIHRoaXMuX3N1cGVyID0gdG1wO1xuXG4gICAgICAgICAgICByZXR1cm4gcmV0O1xuICAgICAgICAgIH07XG4gICAgICAgIH0pKG5hbWUsIHByb3BbbmFtZV0pIDpcbiAgICAgICAgcHJvcFtuYW1lXTtcbiAgICB9XG5cbiAgICAvLyBUaGUgZHVtbXkgY2xhc3MgY29uc3RydWN0b3JcbiAgICBmdW5jdGlvbiBDbGFzcygpIHtcbiAgICAgIC8vIEFsbCBjb25zdHJ1Y3Rpb24gaXMgYWN0dWFsbHkgZG9uZSBpbiB0aGUgaW5pdCBtZXRob2RcbiAgICAgIGlmICggIWluaXRpYWxpemluZyAmJiB0aGlzLmluaXQgKVxuICAgICAgICB0aGlzLmluaXQuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICAvLyBQb3B1bGF0ZSBvdXIgY29uc3RydWN0ZWQgcHJvdG90eXBlIG9iamVjdFxuICAgIENsYXNzLnByb3RvdHlwZSA9IHByb3RvdHlwZTtcblxuICAgIC8vIEVuZm9yY2UgdGhlIGNvbnN0cnVjdG9yIHRvIGJlIHdoYXQgd2UgZXhwZWN0XG4gICAgdmFyIGZ1bmMgPSBuZXcgRnVuY3Rpb24oXG4gICAgICAgIFwicmV0dXJuIGZ1bmN0aW9uIFwiICsgY2xhc3NOYW1lICsgXCIoKXsgfVwiXG4gICAgKSgpO1xuICAgIENsYXNzLnByb3RvdHlwZS5jb25zdHJ1Y3RvciA9IGZ1bmM7XG5cbiAgICAvLyBBbmQgbWFrZSB0aGlzIGNsYXNzIGV4dGVuZGFibGVcbiAgICBDbGFzcy5leHRlbmQgPSBhcmd1bWVudHMuY2FsbGVlO1xuXG4gICAgcmV0dXJuIENsYXNzO1xuICB9O1xuXG4gIC8vSSBvbmx5IGFkZGVkIHRoaXMgbGluZVxuICBtb2R1bGUuZXhwb3J0cyA9IENsYXNzO1xufSkoKTtcbiIsIlxyXG4vLyB0aGUgY2xhc3MuZXh0ZW5kIG5wbSBtb2R1bGUgbXVzdCBiZSBpbmNsdWRlZCBwcmlvciB0byB0aGlzXHJcbi8vIGlmIHlvdSB1c2UgdGhlIGluY2x1ZGVkIG1pbmltaXplZCBmaWxlLCB3ZSd2ZSBidW5kbGVkIHRoYXRcclxuLy8gbW9kdWxlIHRvZ2V0aGVyIHdpdGggdGhpcyBvYmplY3QgZm9yIHlvdS5cclxuXHJcbnZhciBTZWFyY2hiYXIgPSBDbGFzcy5leHRlbmQoe1xyXG5cdHNlYXJjaGJhcjogbnVsbCxcclxuXHRzZWFyY2hhYmxlOiBudWxsLFxyXG5cdGhpZGRlbkNsYXNzOiBcInNlYXJjaGFibGUtcm93LWhpZGRlblwiLFxyXG5cclxuXHRpbml0OiBmdW5jdGlvbigpIHtcclxuXHRcdHRoaXMuc2VhcmNoYmFyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5zZWFyY2hiYXJcIik7XHJcblx0XHR0aGlzLnNlYXJjaGFibGUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnNlYXJjaGFibGVcIik7XHJcblxyXG5cdFx0Ly8gdG8gaGF2ZSBhIHNlYXJjaGJhciwgd2UgbmVlZCBib3RoIHRoZSBzZWFyY2hiYXIgZWxlbWVudCBhbmRcclxuXHRcdC8vIHRoZSBzZWFyY2hhYmxlIGRhdGEgc2V0LiAgd2l0aG91dCB0aG9zZSwgd2UgY2FuIHNpbXBseSBxdWl0XHJcblx0XHQvLyBiZWNhdXNlLCBjbGVhcmx5LCB0aGlzIHBhZ2UgZG9lc24ndCBuZWVkIHRoaXMgZnVuY3Rpb25hbGl0eS5cclxuXHJcblx0XHRpZiAoIXRoaXMuc2VhcmNoYmFyIHx8ICF0aGlzLnNlYXJjaGFibGUpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIG5vdyB0aGF0IHdlIGtub3cgd2UgaGF2ZSB0aG9zZSwgd2UgY2FuIHBhcnNlIHRoZSBzZWFyY2hhYmxlXHJcblx0XHQvLyBkYXRhIHNldCB0byBwcmVwYXJlIGl0IGZvciB1c2UuICBpdCdzIHBvc3NpYmxlIHRoYXQgdGhpcyBtZXRob2RcclxuXHRcdC8vIHJldHVybnMgZmFsc2Ugd2hlbiB0aGVyZSBhcmUgbm8gcm93cyB3aXRoaW4gdGhlIHNldCB0byB3b3JrXHJcblx0XHQvLyB3aXRoLlxyXG5cclxuXHRcdGlmICghdGhpcy5wYXJzZVNlYXJjaGFibGUoKSkge1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gZmluYWxseSwgb3VyIHNlYXJjaGFibGUgZGF0YSBzZXQgaXMgcmVhZHkgdG8gZ28uICBub3csIHdlIGNhblxyXG5cdFx0Ly8gaG9vayB1cCBldmVudHMgdG8gb3VyIHNlYXJjaGJhci5cclxuXHJcblx0XHR2YXIgZWxlbWVudHMgPSB0aGlzLmdldFNlYXJjaGJhckVsZW1lbnRzKCk7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IGVsZW1lbnRzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdHRoaXMucHJvY2Vzc1NlYXJjaGJhckVsZW1lbnQoZWxlbWVudHNbaV0pO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHBhcnNlU2VhcmNoYWJsZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgcm93cyA9IHRoaXMuZ2V0U2VhcmNoYWJsZVJvd3MoKTtcclxuXHJcblx0XHQvLyBpZiB3ZSBkb24ndCBoYXZlIHJvd3MsIHRoZW4gd2UgY2FuIHF1aXQuXHJcblxyXG5cdFx0aWYgKHJvd3MubGVuZ3RoID09PSAwKSB7XHJcblx0XHRcdHJldHVybiBmYWxzZTtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBvdGhlcndpc2UsIGZvciB0aGUgY2hpbGRyZW4gb2Ygb3VyIHJvd3MgLS0gd2hpY2ggYXJlIGxpa2VseVxyXG5cdFx0Ly8gdGFibGUgY2VsbHMsIGJ1dCBjb3VsZCBiZSBzb21ldGhpbmcgZWxzZSAtLSB3ZSB3YW50IHRvIHByb2Nlc3NcclxuXHRcdC8vIHRoZW0gaW5kaXZpZHVhbGx5IHdpdGggdGhlIG1ldGhvZCBiZWxvdy5cclxuXHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0dmFyIGNlbGxzID0gcm93c1tpXS5xdWVyeVNlbGVjdG9yQWxsKFwiW2RhdGEtc2VhcmNoYmFyLXZhbHVlXVwiKTtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBjZWxscy5sZW5ndGg7ICsraikge1xyXG5cdFx0XHRcdHRoaXMucHJvY2Vzc0NlbGwoY2VsbHNbal0sIHJvd3NbaV0pO1xyXG5cdFx0XHR9XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIHRydWU7XHJcblx0fSxcclxuXHJcblx0Z2V0U2VhcmNoYWJsZVJvd3M6IGZ1bmN0aW9uKCkge1xyXG5cclxuXHRcdC8vIGZvciBtYXhpbXVtIGZsZXhpYmlsaXR5LCB3ZSB3YW50IHRvIG1ha2Ugc3VyZSB0aGF0IGEgZGV2ZWxvcGVyXHJcblx0XHQvLyB1c2luZyBvdXIgc2VhcmNoYmFyIGNhbiBzcGVjaWZ5IHdoYXQgc2hvdWxkIGJlIGNvbnNpZGVyZWQgYVxyXG5cdFx0Ly8gc2VhcmNoYWJsZSByb3cuICBidXQsIGlmIHRoZXkgZG9uJ3QgYW5kIGlmIHRoZSBzZWFyY2hhYmxlIERPTVxyXG5cdFx0Ly8gZWxlbWVudCBpcyBhIHRhYmxlLCB0aGVuIHdlJ2xsIGp1c3QgdXNlIHRoZSByb3dzIGluIGl0cyB0YWJsZVxyXG5cdFx0Ly8gYm9keSBieSBkZWZhdWx0LlxyXG5cclxuXHRcdHZhciByb3dzID0gdGhpcy5zZWFyY2hhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCIuc2VhcmNoYWJsZS1yb3dcIik7XHJcblx0XHRpZiAocm93cy5sZW5ndGggPT09IDAgJiYgdGhpcy5zZWFyY2hhYmxlLnRhZ05hbWUgPT09IFwiVEFCTEVcIikge1xyXG5cdFx0XHRyb3dzID0gdGhpcy5zZWFyY2hhYmxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCJ0Ym9keSB0clwiKTtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gcm93cztcclxuXHR9LFxyXG5cclxuXHRwcm9jZXNzQ2VsbDogZnVuY3Rpb24oY2VsbCwgcm93KSB7XHJcblxyXG5cdFx0Ly8gdG8gcHJvY2VzcyBhIGNlbGwsIHdlIHdhbnQgdG8gYWRkIEhUTUw1IGRhdGEgYXR0cmlidXRlcyB0aGF0XHJcblx0XHQvLyBjb3JyZXNwb25kIHRvIGluZm9ybWF0aW9uIGV4dHJhY3RlZCBmcm9tIHRoZSBjZWxsIGl0c2VsZiB0b1xyXG5cdFx0Ly8gdGhlIHNwZWNpZmllZCByb3cuICB0aGlzIGlzIGJlY2F1c2Ugb3VyIHNlYXJjaCBtZXRob2QgbG9va3NcclxuXHRcdC8vIGF0IHRoZSByb3dzIHdoZW4gbWF0Y2hpbmcgZW50cmllcyBhZ2FpbnN0IGRhdGEuXHJcblxyXG5cdFx0dmFyIGF0dHIgPSBcImRhdGEtXCIgKyBjZWxsLmdldEF0dHJpYnV0ZShcImhlYWRlcnNcIik7XHJcblx0XHR2YXIgdmFsdWUgPSBjZWxsLmdldEF0dHJpYnV0ZShcImRhdGEtc2VhcmNoYmFyLXZhbHVlXCIpO1xyXG5cdFx0cm93LnNldEF0dHJpYnV0ZShhdHRyLCB2YWx1ZSk7XHJcblxyXG5cdFx0aWYgKGNlbGwuZ2V0QXR0cmlidXRlKFwiZGF0YS1zZWFyY2hiYXItdmFsdWUtbGlzdFwiKSA9PT0gXCIxXCIpIHtcclxuXHRcdFx0cm93LnNldEF0dHJpYnV0ZShhdHRyICsgXCItbGlzdFwiLCAxKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXRTZWFyY2hiYXJFbGVtZW50czogZnVuY3Rpb24oKSB7XHJcblxyXG5cdFx0Ly8gb3VyIHNlYXJjaGJhciB1c2VzIHRoZXNlIEhUTUwgZWxlbWVudHMgYXQgdGhlIG1vbWVudC4gIGlmIHdlXHJcblx0XHQvLyBhZCBtb3JlLCB3ZSdsbCBuZWVkIHRvIHVwZGF0ZSB0aGlzIGxpc3QuXHJcblxyXG5cdFx0cmV0dXJuIHRoaXMuc2VhcmNoYmFyLnF1ZXJ5U2VsZWN0b3JBbGwoXCJpbnB1dCwgc2VsZWN0LCBidXR0b25cIik7XHJcblx0fSxcclxuXHJcblx0cHJvY2Vzc1NlYXJjaGJhckVsZW1lbnQ6IGZ1bmN0aW9uKGVsZW1lbnQpIHtcclxuXHRcdHZhciBldmVudCA9IFwiXCIsIHdhaXQgPSAwO1xyXG5cclxuXHRcdC8vIHRoZSBldmVudCB3ZSB3YW50IHRvIHVzZSBpcyBiYXNlZCBvbiB0aGUgdHlwZSBvZiBlbGVtZW50IHRoYXRcclxuXHRcdC8vIHdlJ3JlIHdvcmtpbmcgd2l0aC4gIG1vc3Qgb2Ygb3VyIGV2ZW50cyBkb24ndCBuZWVkIHRvIGJlXHJcblx0XHQvLyBkZWJvdW5jZWQsIGJ1dCBpZiB3ZSBydW4gaW50byBvbmUgdGhhdCBkb2VzLCB3ZSBjYW4gc2V0IG91clxyXG5cdFx0Ly8gd2FpdCB2YXJpYWJsZSB0byBzb21ldGhpbmcgb3RoZXIgdGhhbiB6ZXJvLlxyXG5cclxuXHRcdHN3aXRjaCAoZWxlbWVudC50eXBlKSB7XHJcblx0XHRcdGNhc2UgXCJ0ZXh0XCI6XHJcblx0XHRcdFx0ZXZlbnQgPSBcImtleXVwXCI7XHJcblx0XHRcdFx0d2FpdCA9IDE1MDtcclxuXHRcdFx0XHRicmVhaztcclxuXHJcblx0XHRcdGNhc2UgXCJzZWxlY3Qtb25lXCI6XHJcblx0XHRcdFx0ZXZlbnQgPSBcImNoYW5nZVwiO1xyXG5cdFx0XHRcdGJyZWFrO1xyXG5cclxuXHRcdFx0Y2FzZSBcImNoZWNrYm94XCI6XHJcblx0XHRcdFx0ZXZlbnQgPSBcImNsaWNrXCI7XHJcblx0XHRcdFx0YnJlYWs7XHJcblxyXG5cdFx0XHRjYXNlIFwicmVzZXRcIjpcclxuXHRcdFx0XHRldmVudCA9IFwiY2xpY2tcIjtcclxuXHRcdFx0XHRicmVhaztcclxuXHRcdH1cclxuXHJcblx0XHRpZiAoZXZlbnQubGVuZ3RoID4gMCkge1xyXG5cclxuXHRcdFx0Ly8gaWYgd2UgaWRlbnRpZmllZCBhbiBldmVudCB0byBsaXN0ZW4gZm9yLCB3ZSdsbCBub3cgaWRlbnRpZnlcclxuXHRcdFx0Ly8gd2hpY2ggZnVuY3Rpb24gdG8gY2FsbC4gIGlmIHdlJ3JlIG5vdCBtZXNzaW5nIHdpdGggdGhlIHJlc2V0XHJcblx0XHRcdC8vIGVsZW1lbnQsIHdlIHNlYXJjaDsgb3RoZXJ3aXNlIHdlIHJlc2V0LlxyXG5cclxuXHRcdFx0dmFyIGZ1bmMgPSBlbGVtZW50LnR5cGUgIT09IFwicmVzZXRcIlxyXG5cdFx0XHRcdD8gdGhpcy5kZWJvdW5jZSh0aGlzLnNlYXJjaCwgd2FpdCkuYmluZCh0aGlzKVxyXG5cdFx0XHRcdDogdGhpcy5yZXNldC5iaW5kKHRoaXMpO1xyXG5cclxuXHRcdFx0ZWxlbWVudC5hZGRFdmVudExpc3RlbmVyKGV2ZW50LCBmdW5jKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRzZWFyY2g6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGJlZm9yZVNlYXJjaCA9IG5ldyBFdmVudChcInNlYXJjaGJhcjpiZWZvcmVTZWFyY2hcIik7XHJcblx0XHR2YXIgY2FuY2VsbGVkID0gIXRoaXMuc2VhcmNoYmFyLmRpc3BhdGNoRXZlbnQoYmVmb3JlU2VhcmNoKTtcclxuXHRcdGlmIChjYW5jZWxsZWQpIHtcclxuXHRcdFx0cmV0dXJuO1xyXG5cdFx0fVxyXG5cclxuXHRcdC8vIGFzc3VtaW5nIHNvbWV0aGluZyBlbHNlIGRpZG4ndCBjYW5jZWwgb3VyIHNlYXJjaCwgdGhlIGZpcnN0XHJcblx0XHQvLyB0aGluZyB3ZSBkbyBpcyByZXNldCBvdXIgdGFibGUuICB0aGF0IHdheSwgd2Uga25vdyB0aGF0IHdlXHJcblx0XHQvLyBzdGFydCB3aXRoIHRoZSBlbnRpcmUgdGhpbmcgdmlzaWJsZSBhbmQgd2UnbGwgZmluZCB0aGUgb25lc1xyXG5cdFx0Ly8gdGhhdCBuZWVkIHRvIGJlIGhpZGRlbiBiZWxvdy5cclxuXHJcblx0XHR0aGlzLnJlc2V0U2VhcmNoYWJsZSgpO1xyXG5cdFx0dmFyIHJvd3MgPSB0aGlzLmdldFNlYXJjaGFibGVSb3dzKCk7XHJcblx0XHRmb3IgKHZhciBpID0gMDsgaSA8IHJvd3MubGVuZ3RoOyArK2kpIHtcclxuXHRcdFx0dmFyIHJvdyA9IHJvd3NbaV0sIHNob3cgPSB0cnVlO1xyXG5cclxuXHRcdFx0Ly8gZm9yIGVhY2ggcm93LCB3ZSBuZWVkIHRvIGNvbXBhcmUgdGhlIGluZm9ybWF0aW9uIGluIHRoZVxyXG5cdFx0XHQvLyBIVE1MNSBkYXRhIGF0dHJpYnV0ZXMgYWRkZWQgYnkgdGhlIHBhcnNlU2VhcmNoYWJsZSgpIG1ldGhvZFxyXG5cdFx0XHQvLyBhYm92ZSBhZ2FpbnN0IHRoZSB2YWx1ZXMgaW4gb3VyIHNlYXJjaGJhciBlbGVtZW50cy5cclxuXHJcblx0XHRcdHZhciBlbGVtZW50cyA9IHRoaXMuZ2V0U2VhcmNoYmFyRWxlbWVudHMoKTtcclxuXHRcdFx0Zm9yICh2YXIgaiA9IDA7IGogPCBlbGVtZW50cy5sZW5ndGg7IGorKykge1xyXG5cdFx0XHRcdGlmICghc2hvdykge1xyXG5cclxuXHRcdFx0XHRcdC8vIHdlIHVzZSBBTkQgbG9naWMgaGVyZS4gIHRoZSBmaXJzdCB0aGluZyB0aGF0IHdvdWxkXHJcblx0XHRcdFx0XHQvLyBoaWRlIG91ciByb3cgbWVhbnMgdGhlIHJvdyBpcyBoaWRkZW4gYW5kIHdlIGNhblxyXG5cdFx0XHRcdFx0Ly8gc2tpcCBhbGwgb3RoZXIgY3JpdGVyaW9uLlxyXG5cclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmFyIGVsZW1lbnQgPSBlbGVtZW50c1tqXTtcclxuXHRcdFx0XHR2YXIgdmFsdWUgPSB0aGlzLmdldFZhbHVlKGVsZW1lbnQpO1xyXG5cdFx0XHRcdHZhciBhdHRyID0gdGhpcy5nZXRBdHRyKGVsZW1lbnQpO1xyXG5cclxuXHRcdFx0XHQvLyBpZiB3ZSBkb24ndCBoYXZlIGFuIGF0dHJpYnV0ZSBvciB2YWx1ZSBvciBpZiB0aGUgdmFsdWVcclxuXHRcdFx0XHQvLyB3ZSBkbyBoYXZlIGluZGljYXRlcyB0aGF0IHdlIHNob3VsZCBiZSBzaG93aW5nIGFsbCBvZlxyXG5cdFx0XHRcdC8vIG91ciByb3dzLCB3ZSBjYW4gc2ltcGx5IG1vdmUgb247IHRoaXMgY3JpdGVyaWEgaXMsXHJcblx0XHRcdFx0Ly8gZWZmZWN0aXZlbHksIGFsd2F5cyBtZXQuXHJcblxyXG5cdFx0XHRcdGlmICghYXR0ciB8fCAhdmFsdWUgfHwgdmFsdWUgPT09IFwiYWxsXCIpIHtcclxuXHRcdFx0XHRcdGNvbnRpbnVlO1xyXG5cdFx0XHRcdH1cclxuXHJcblx0XHRcdFx0dmFyIGNyaXRlcmlvbiA9IGVsZW1lbnQudHlwZSAhPT0gXCJ0ZXh0XCJcclxuXHRcdFx0XHRcdD8gdGhpcy5ub25UZXh0U2VhcmNoKHJvdywgYXR0ciwgdmFsdWUpXHJcblx0XHRcdFx0XHQ6IHRoaXMudGV4dFNlYXJjaChyb3csIGF0dHIsIHZhbHVlKTtcclxuXHJcblx0XHRcdFx0c2hvdyA9IHNob3cgJiYgY3JpdGVyaW9uO1xyXG5cdFx0XHR9XHJcblxyXG5cdFx0XHRpZiAoIXNob3cpIHtcclxuXHJcblx0XHRcdFx0Ly8gZmluYWxseSwgaWYgdGhpcyByb3cgc2hvdWxkIG5vdCBiZSBzaG93biwgdGhlbiB3ZSBhZGRcclxuXHRcdFx0XHQvLyB0aGUgaGlkZGVuIGNsYXNzIHRvIGl0LlxyXG5cclxuXHRcdFx0XHRyb3cuY2xhc3NMaXN0LmFkZCh0aGlzLmhpZGRlbkNsYXNzKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cclxuXHRcdHRoaXMuc2VhcmNoYmFyLmRpc3BhdGNoRXZlbnQobmV3IEV2ZW50KFwic2VhcmNoYmFyOmFmdGVyU2VhcmNoXCIpKTtcclxuXHR9LFxyXG5cclxuXHRnZXRWYWx1ZTogZnVuY3Rpb24oZWxlbWVudCkge1xyXG5cclxuXHRcdC8vIHRleHQsIHNlbGVjdHMsIGFuZCBjaGVja2JveGVzIGFsbCB3b3JrIGRpZmZlcmVudGx5IHdpdGhcclxuXHRcdC8vIHJlc3BlY3QgdG8gd2hhdCB3ZSBjb25zaWRlciBvdXIgXCJ2YWx1ZVwiIGZvciBzZWFyY2hpbmdcclxuXHRcdC8vIHB1cnBvc2VzLiAgdGhpcyBzd2l0Y2ggc3RhdGVtZW50IG1peGVzIHRoaW5ncyB1cCBhbmRcclxuXHRcdC8vIGdyYWJzIG9ubHkgd2hhdCB3ZSBuZWVkIGR1cmluZyBvdXIgc2VhcmNoIGFib3ZlIHRvIG1ha2VcclxuXHRcdC8vIHRoaW5ncyBoYXBwZW4uXHJcblxyXG5cdFx0c3dpdGNoIChlbGVtZW50LnR5cGUpIHtcclxuXHRcdFx0Y2FzZSBcInRleHRcIjpcclxuXHRcdFx0XHRyZXR1cm4gZWxlbWVudC52YWx1ZTtcclxuXHJcblx0XHRcdGNhc2UgXCJzZWxlY3Qtb25lXCI6XHJcblx0XHRcdFx0cmV0dXJuIGVsZW1lbnQub3B0aW9uc1tlbGVtZW50LnNlbGVjdGVkSW5kZXhdLnZhbHVlO1xyXG5cclxuXHRcdFx0Y2FzZSBcImNoZWNrYm94XCI6XHJcblx0XHRcdFx0cmV0dXJuIGVsZW1lbnQuY2hlY2tlZDtcclxuXHRcdH1cclxuXHJcblx0XHRyZXR1cm4gXCJcIjtcclxuXHR9LFxyXG5cclxuXHRnZXRBdHRyOiBmdW5jdGlvbihlbGVtZW50KSB7XHJcblxyXG5cdFx0Ly8gdGhlIEhUTUw1IGRhdGEgZWxlbWVudHMgdGhhdCBwYXJzZVNlYXJjaGFibGUoKSBjcmVhdGVzXHJcblx0XHQvLyBhcmUgZGF0YS1baWRdIHdoZXJlIHRoZSBpZCBpcyB0aGUgdmFsdWUgb2Ygb3VyIGVsZW1lbnQnc1xyXG5cdFx0Ly8gSUQgYXR0cmlidXRlLlxyXG5cclxuXHRcdHZhciBpZCA9IGVsZW1lbnQuZ2V0QXR0cmlidXRlKFwiaWRcIik7XHJcblxyXG5cdFx0aWYgKGlkKSB7XHJcblxyXG5cdFx0XHQvLyBpZiB3ZSBoYXZlIGFuIElELCB0aGVuIHdlIG5lZWQgdG8gcmVtb3ZlIGV2ZXJ5dGhpbmdcclxuXHRcdFx0Ly8gYWZ0ZXIgdGhlIHVuZGVyc2NvcmUsIGluY2x1ZGluZyB0aGUgdW5kZXJzY29yZS4gIHdlXHJcblx0XHRcdC8vIGV4cGVjdCBvdXIgSURzIGZvciBzZWFyY2hpbmcgZWxlbWVudHMgdG8gYmUgaW4gdGhlXHJcblx0XHRcdC8vIGZvcm0gb2YgW2lkXV9bdHlwZV0sIHNvIHRoaXMgc2ltcGx5IGxlYXZlcyB1cyB3aXRoXHJcblx0XHRcdC8vIHRoZSBpZC5cclxuXHJcblx0XHRcdGlkID0gaWQucmVwbGFjZSgvXy4qLywgXCJcIik7XHJcblx0XHR9IGVsc2Uge1xyXG5cdFx0XHRyZXR1cm4gXCJcIjtcclxuXHRcdH1cclxuXHJcblx0XHQvLyBzdGlsbCBoZXJlPyAgdGhlbiB3ZSBjYW4gY29uc3RydWN0IHRoZSBvdXIgZGF0YVxyXG5cdFx0Ly8gYXR0cmlidXRlIHVzaW5nIHRoZSBJRCB3ZSdyZSBsZWZ0IHdpdGguXHJcblxyXG5cdFx0cmV0dXJuIFwiZGF0YS1cIiArIGlkO1xyXG5cdH0sXHJcblxyXG5cdG5vblRleHRTZWFyY2g6IGZ1bmN0aW9uKHJvdywgYXR0ciwgdmFsdWUpIHtcclxuXHJcblx0XHQvLyBpZiBvdXIgcm93IGhhcyBhIGxpc3QgZmxhZyBmb3IgdGhpcyBhdHRyaWJ1dGUsIHRoZW4gd2VcclxuXHRcdC8vIHdhbnQgdG8gc2VlIGlmIG91ciBhdHRyaWJ1dGUgY29udGFpbnMgdGhlIHZhbHVlLiAgb3RoZXJ3aXNlLFxyXG5cdFx0Ly8gd2UgY2hlY2sgdG8gc2VlIHRoZSBhdHRyaWJ1dGUgbWF0Y2hlcyBpdC4gIHdpdGggcmVzcGVjdCB0b1xyXG5cdFx0Ly8gdGhlIG1hdGNoZXMoKSBjYWxsIGhlcmUsIGlmIHdlIGFzc3VtZSBvdXIgdmFsdWUgaXMgMSwgdGhlblxyXG5cdFx0Ly8gd2Ugc2VhcmNoIGZvciBfMV8uICB0aGlzIGlzIHRvIGF2b2lkIGludmFsaWQgc2VsZWN0b3IgZXJyb3JzXHJcblx0XHQvLyB3aXRoaW4gdGhlIGphdmFzY3JpcHQuICBmdXJ0aGVyLCBpdCBoZWxwcyBkaXN0aW5ndWlzaCBiZXR3ZWVuXHJcblx0XHQvLyBfMV8gYW5kIF8xMV8gb3IgX3dvbl8gYW5kIF93b25kZXJfLCBmb3IgZXhhbXBsZS5cclxuXHJcblx0XHRyZXR1cm4gcm93Lmhhc0F0dHJpYnV0ZShhdHRyICsgXCItbGlzdFwiKVxyXG5cdFx0XHQ/IHJvdy5tYXRjaGVzKFwiW1wiICsgYXR0ciArIFwiKj1fXCIgKyB2YWx1ZSArIFwiX11cIilcclxuXHRcdFx0OiByb3cuZ2V0QXR0cmlidXRlKGF0dHIpID09PSB2YWx1ZTtcclxuXHR9LFxyXG5cclxuXHR0ZXh0U2VhcmNoOiBmdW5jdGlvbihyb3csIGF0dHIsIHZhbHVlKSB7XHJcblxyXG5cdFx0Ly8gZm9yIHRleHQgc2VhcmNoZXMsIHdlIGNvbnN0cnVjdCBhIHJlZ2V4IGZyb20gdGhlIHZhbHVlIG9mXHJcblx0XHQvLyBvdXIgc2VhcmNoIGZpZWxkIGFuZCBzZWUgaWYgdGhpcyByb3cgbWF0Y2hlcyBpdC4gIHdlIHB1dFxyXG5cdFx0Ly8gdGhpcyBhbGwgaW5zaWRlIGEgdHJ5L2NhdGNoIGJsb2NrIGJlY2F1c2UgaXQncyBwb3NzaWJsZSB0b1xyXG5cdFx0Ly8gY3JlYXRlIGEgdmFsdWUgdGhhdCBjYW4ndCBiZSBhIHJlZ2V4LCBhbmQgdGhlbiBhbiBleGNlcHRpb25cclxuXHRcdC8vIGlzIHRocm93bi5cclxuXHJcblx0XHR0cnkge1xyXG5cdFx0XHR2YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAodmFsdWUsIFwiaVwiKTtcclxuXHRcdFx0cmV0dXJuIHJvdy5nZXRBdHRyaWJ1dGUoYXR0cikubWF0Y2gocGF0dGVybik7XHJcblx0XHR9IGNhdGNoIChlKSB7XHJcblxyXG5cdFx0XHQvLyBpZiB3ZSBjb3VsZG4ndCBldmVuIG1ha2Ugb3VyIHBhdHRlcm4sIHRoZW4gd2UnbGwgYXNzdW1lXHJcblx0XHRcdC8vIHRoYXQgd2hhdGV2ZXIgd2UgaGF2ZSBjb3VsZCBub3QgYmUgbWF0Y2hlZCBhbmQgcmV0dXJuXHJcblx0XHRcdC8vIGZhbHNlLlxyXG5cclxuXHRcdFx0cmV0dXJuIGZhbHNlO1xyXG5cdFx0fVxyXG5cdH0sXHJcblxyXG5cdHJlc2V0OiBmdW5jdGlvbigpIHtcclxuXHRcdHZhciBiZWZvcmVSZXNldCA9IG5ldyBFdmVudChcInNlYXJjaGJhcjpyZXNldFwiKTtcclxuXHRcdHZhciBjYW5jZWxsZWQgPSAhdGhpcy5zZWFyY2hiYXIuZGlzcGF0Y2hFdmVudChiZWZvcmVSZXNldCk7XHJcblxyXG5cdFx0aWYgKCFjYW5jZWxsZWQpIHtcclxuXHJcblx0XHRcdC8vIGlmIG5vIG9uZSBjYW5jZWxsZWQgb3VyIHJlc2V0LCB0aGVuIHdlIGp1c3QgcmVzZXQgdGhlXHJcblx0XHRcdC8vIHNlYXJjaGJhciBmb3JtIGFuZCBvdXIgc2VhcmNoYWJsZSBkYXRhIHNldC5cclxuXHJcblx0XHRcdHRoaXMuc2VhcmNoYmFyLnJlc2V0KCk7XHJcblx0XHRcdHRoaXMucmVzZXRTZWFyY2hhYmxlKCk7XHJcblx0XHR9XHJcblxyXG5cdFx0cmV0dXJuIGZhbHNlO1xyXG5cdH0sXHJcblxyXG5cdHJlc2V0U2VhcmNoYWJsZTogZnVuY3Rpb24oKSB7XHJcblx0XHR2YXIgcm93cyA9IHRoaXMuZ2V0U2VhcmNoYWJsZVJvd3MoKTtcclxuXHJcblx0XHQvLyByZXNldHRpbmcgb3VyIGRhdGEgc2V0IGlzIHNpbXBsZTogIHdlIGp1c3QgcmVtb3ZlIHRoZSBoaWRkZW5cclxuXHRcdC8vIGNsYXNzIGZyb20gYWxsIHJvd3MuXHJcblxyXG5cdFx0Zm9yICh2YXIgaSA9IDA7IGkgPCByb3dzLmxlbmd0aDsgKytpKSB7XHJcblx0XHRcdHJvd3NbaV0uY2xhc3NMaXN0LnJlbW92ZSh0aGlzLmhpZGRlbkNsYXNzKTtcclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRkZWJvdW5jZTogZnVuY3Rpb24oZnVuYywgd2FpdCwgaW1tZWRpYXRlKSB7XHJcblx0XHRpZiAod2FpdCA9PT0gMCkge1xyXG5cdFx0XHRyZXR1cm4gZnVuYztcclxuXHRcdH1cclxuXHJcblx0XHQvLyBzb3VyY2U6IGh0dHBzOi8vZGF2aWR3YWxzaC5uYW1lL2phdmFzY3JpcHQtZGVib3VuY2UtZnVuY3Rpb25cclxuXHJcblx0XHR2YXIgdGltZW91dDtcclxuXHRcdHJldHVybiBmdW5jdGlvbigpIHtcclxuXHRcdFx0dmFyIGNvbnRleHQgPSB0aGlzLCBhcmdzID0gYXJndW1lbnRzO1xyXG5cdFx0XHR2YXIgbGF0ZXIgPSBmdW5jdGlvbigpIHtcclxuXHRcdFx0XHR0aW1lb3V0ID0gbnVsbDtcclxuXHRcdFx0XHRpZiAoIWltbWVkaWF0ZSkgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcclxuXHRcdFx0fTtcclxuXHRcdFx0dmFyIGNhbGxOb3cgPSBpbW1lZGlhdGUgJiYgIXRpbWVvdXQ7XHJcblx0XHRcdGNsZWFyVGltZW91dCh0aW1lb3V0KTtcclxuXHRcdFx0dGltZW91dCA9IHNldFRpbWVvdXQobGF0ZXIsIHdhaXQpO1xyXG5cdFx0XHRpZiAoY2FsbE5vdykgZnVuYy5hcHBseShjb250ZXh0LCBhcmdzKTtcclxuXHRcdH07XHJcblx0fVxyXG59KTtcclxuIiwidmFyIEZvY3VzZXIgPSBDbGFzcy5leHRlbmQoe1xyXG5cdGluaXQ6IGZ1bmN0aW9uKCkge1xyXG5cdFx0dmFyIGVsZW1lbnQgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiW2F1dG9mb2N1c11cIik7XHJcblx0XHRpZiAoZWxlbWVudCAmJiBlbGVtZW50Lmxlbmd0aCA+IDApIHtcclxuXHRcdFx0ZWxlbWVudFswXS5mb2N1cygpO1xyXG5cdFx0XHRyZXR1cm47XHJcblx0XHR9XHJcblxyXG5cdFx0Ly8gaWYgd2UgaGF2ZW4ndCBsZWZ0IHlldCwgdGhlbiB3ZSdsbCBjaGVjayBmb3IgYSBzaGFkb3dsYWIgZm9ybVxyXG5cdFx0Ly8gYW5kIGlmIHdlIGZpbmQgaXQsIHdlIGZpbmQgaXQncyBmaXJzdCBlbGVtZW50IGFuZCBmb2N1cyBpdC5cclxuXHJcblx0XHR2YXIgZm9ybSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwic2hhZG93bGFiLWZvcm1cIik7XHJcblx0XHRpZiAoZm9ybSkge1xyXG5cdFx0XHR2YXIgaW5wdXRzID0gZm9ybS5xdWVyeVNlbGVjdG9yKFwiaW5wdXQsIHNlbGVjdCwgdGV4dGFyZWFcIik7XHJcblx0XHRcdGlmIChpbnB1dHMgJiYgaW5wdXRzLmxlbmd0aCA+IDApIHtcclxuXHRcdFx0XHRpbnB1dHNbMF0uZm9jdXMoKTtcclxuXHRcdFx0fVxyXG5cdFx0fVxyXG5cdH1cclxufSk7XHJcbiIsInZhciBTdW1tYXJpemVyID0gQ2xhc3MuZXh0ZW5kKHtcclxuXHRlbGVtZW50OiBudWxsLFxyXG5cclxuXHQvLyB0aGlzIG9iamVjdCBlbmNhcHN1bGF0ZXMgdGhlIGJlaGF2aW9ycyBuZWNlc3NhcnkgdG8gaGFuZGxlIHRoZVxyXG5cdC8vIHNob3dpbmcgYW5kIGhpZGluZyBvZiBpbmZvcm1hdGlvbiBpbiBzdW1tYXJpemVkIHRhYmxlcy4gIGl0IHVzZWRcclxuXHQvLyB0byBiZSBhIGpRdWVyeSBwbHVnaW47IHRoaXMgaXMgdGhlIHB1cmUtSlMgcG9ydCBvZiBpdC4gIGl0XHJcblx0Ly8gcmVxdWlyZXMgdGhlIGNsYXNzLmV4dGVuZCBucG0gbW9kdWxlLlxyXG5cclxuXHRpbml0OiBmdW5jdGlvbihlbGVtZW50KSB7XHJcblx0XHRpZiAoIWVsZW1lbnQpIHtcclxuXHRcdFx0ZWxlbWVudCA9IHRoaXMuZ2V0RWxlbWVudCgpO1xyXG5cdFx0fVxyXG5cclxuXHRcdGlmIChlbGVtZW50LnRhZ05hbWUgJiZcclxuXHRcdFx0ZWxlbWVudC50YWdOYW1lID09PSBcIlRBQkxFXCIgJiZcclxuXHRcdFx0ZWxlbWVudC5tYXRjaGVzKFwiLnN1bW1hcml6ZWRcIilcclxuXHRcdCkge1xyXG5cclxuXHRcdFx0Ly8gbm93IHRoYXQgd2Uga25vdyB0aGUgZWxlbWVudCBpcyBhIHRhYmxlIGFuZCB0aGF0IGl0J3NcclxuXHRcdFx0Ly8gc3VtbWFyaXplZCwgd2UgY2FuIGF0dGFjaCBvdXIgYmVoYXZpb3JzIHRvIGl0LlxyXG5cclxuXHRcdFx0dmFyIGNsaWNrZXJzID0gZWxlbWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnN1bW1hcnkgKjpmaXJzdC1jaGlsZCBhXCIpO1xyXG5cdFx0XHRmb3IodmFyIGk9MDsgaSA8IGNsaWNrZXJzLmxlbmd0aDsgaSsrKSB7XHJcblx0XHRcdFx0Y2xpY2tlcnNbaV0uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIHRoaXMuc3VtbWFyeUNsaWNrZWQuYmluZCh0aGlzKSk7XHJcblx0XHRcdH1cclxuXHRcdH1cclxuXHR9LFxyXG5cclxuXHRnZXRFbGVtZW50OiBmdW5jdGlvbigpIHtcclxuXHJcblx0XHQvLyB0byBnZXQgb3VyIGVsZW1lbnQsIHdlIHNpbXBseSBsb29rIGZvciBhIHRhYmxlIHRoYXQncyBzdW1tYXJpemVkLlxyXG5cdFx0Ly8gYXQgdGhlIG1vbWVudCwgd2UgZG9uJ3Qgd29ycnkgaWYgdGhlcmUncyBtb3JlIHRoYW4gb25lOyB0aGF0J2xsXHJcblx0XHQvLyBiZSBmb3IgdGhlIGZ1dHVyZSBpZiBuZWNlc3NhcnkuXHJcblxyXG5cdFx0cmV0dXJuIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCJ0YWJsZS5zdW1tYXJpemVkXCIpO1xyXG5cdH0sXHJcblxyXG5cdHN1bW1hcnlDbGlja2VkOiBmdW5jdGlvbihldmVudCkge1xyXG5cclxuXHRcdC8vIHdoZW4gb25lIG9mIG91ciBzdW1tYXJpZXMgaXMgY2xpY2tlZCwgd2Ugd2FudCB0byBnZXQgdGhlXHJcblx0XHQvLyBuZWFyZXN0IDx0Ym9keT4gZWxlbWVudCBhbmQgdG9nZ2xlIGl0J3MgY2xpY2tlZCBjbGFzcy5cclxuXHJcblx0XHR2YXIgdGJvZHkgPSB0aGlzLmdldENsb3Nlc3QoZXZlbnQudGFyZ2V0LCBcInRib2R5XCIpO1xyXG5cdFx0dGhpcy50b2dnbGVDbGFzcyh0Ym9keSwgXCJjbGlja2VkXCIpO1xyXG5cdFx0ZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XHJcblx0XHRldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG5cdH0sXHJcblxyXG5cdGdldENsb3Nlc3Q6IGZ1bmN0aW9uKGVsZW1lbnQsIHRhcmdldCkge1xyXG5cclxuXHRcdC8vIHRvIGZpbmQgdGhlIGNsb3Nlc3QgdGFyZ2V0IG1hdGNoIHRvIG91ciBlbGVtZW50LCB3ZSBjYW5cclxuXHRcdC8vIHVzZSBhIGRvLXdoaWxlIGxvb3AuICB3ZSdsbCBzZWUgaWYgZWxlbWVudCBtYXRjaGVzIG91clxyXG5cdFx0Ly8gdGFyZ2V0IGFuZCB0aGVuIHdoZW4gd2UgZmluZCB0aGUgbWF0Y2gsIHdlIHJldHVybiBpdC5cclxuXHJcblx0XHRkbyB7XHJcblx0XHRcdGlmIChlbGVtZW50Lm1hdGNoZXModGFyZ2V0KSkge1xyXG5cdFx0XHRcdHJldHVybiBlbGVtZW50O1xyXG5cdFx0XHR9XHJcblx0XHR9IHdoaWxlIChlbGVtZW50ID0gZWxlbWVudC5wYXJlbnROb2RlKTtcclxuXHJcblx0XHQvLyBvdGhlcndpc2UsIGlmIHdlIHdvcmsgb3VyIHdheSBhbGwgdGhlIHdheSB0byB0aGUgdG9wIG9mXHJcblx0XHQvLyBvdXIgRE9NIHRyZWUsIHdlJ2xsIGp1c3QgcmV0dXJuIG51bGwgaW5zdGVhZC5cclxuXHJcblx0XHRyZXR1cm4gbnVsbDtcclxuXHR9LFxyXG5cclxuXHR0b2dnbGVDbGFzczogZnVuY3Rpb24oZWxlbWVudCwgY2xhc3NOYW1lKSB7XHJcblx0XHRlbGVtZW50LmNsYXNzTGlzdC50b2dnbGUoY2xhc3NOYW1lLCAhZWxlbWVudC5jbGFzc0xpc3QuY29udGFpbnMoY2xhc3NOYW1lKSk7XHJcblx0fVxyXG59KTtcclxuIl19
